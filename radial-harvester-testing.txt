DVAR $hFile
DVAR $cCheck
DVAR $press
DVAR $length
DVAR $lame
DVAR $comport


DVAR $found, $floor $delta $deltafast $Ax $Ay $Bx $By $Cx $Cy $Dx $Dy $Px $Py $posA $posB $posC $posD $posZ $fastfeed $midfeed $slowfeed $Astart $Bstart $Cstart $Dstart $Pstart $comma1 $comma2 $comma1plus $comma2plus
DVAR $Ax_dif $Ay_dif $Bx_dif $By_dif $Cx_dif $Cy_dif $Dx_dif $Dy_dif $Px_dif $Py_dif
DVAR $nozzle $nozzleA $nozzleB $nozzleC $nozzleD $profilometerRod $xStart $yStart $zStart 
DVAR $zMeasureA $zMeasureB $zMeasureC $zMeasureD $Az_dif $Bz_dif $Cz_dif $Dz_dif $xOffset $yOffset
DVAR $zA $zB $zC $zD $check
DVAR $zSweepRange $zSweepStep $numsteps $tempdistance $zDwell $count $z_dif $z_past $z_num $indicator $step $start $x_dist
DVAR $align_save
FILECLOSE 

$floor = -72
$deltafast = 1
$delta = 0.1
$fastfeed = 40
$midfeed = 10
$slowfeed = 2
$Astart = -15
$Bstart = -15
$Cstart = -15
$Dstart = -15
$Pstart = -15
$nozzleA=1
$nozzleB=2
$nozzleC=3
$nozzleD=4
$profilometerRod = 5

$Ax = 586.075
$Ay = 367.8285
$Bx = 482.075
$By = 367.8285
$Cx = 378.075
$Cy = 367.8285
$Dx = 299.075
$Dy = 367.8285
$Px = 148
$Py = 345

$DO0.0=0
$DO1.0=0
$DO2.0=0
$DO3.0=0
Primary ; sets primary units mm and s
G65 F2000; accel speed mm/s^2
G66 F2000;accel speed mm/s^2
ENABLE X Y A B C D U
POSOFFSET CLEAR X Y U A B C D
G91 ;start off in relative mode

G90
G1 z0.200000
G91
G90
G1 X0.000000 Y-0.500000
G91
sign is 1
G17
G2 Y1 X0 R0.5
G17
sign is -1
G17
G2 Y-2 X0 R1.0
G17
sign is 1
G17
G2 Y3 X0 R1.5
G17
sign is -1
G17
G2 Y-4 X0 R2.0
G17
sign is 1
G17
G2 Y5 X0 R2.5
G17
sign is -1
G17
G2 Y-6 X0 R3.0
G17
sign is 1
G17
G2 Y7 X0 R3.5
G17
sign is -1
G17
G2 Y-8 X0 R4.0
G17
sign is 1
G17
G2 Y9 X0 R4.5
G17
sign is -1
G17
G2 Y-10 X0 R5.0
G17
sign is 1
G17
G2 Y11 X0 R5.5
G17
sign is -1
G17
G2 Y-12 X0 R6.0
G17
sign is 1
G17
G2 Y13 X0 R6.5
G17
sign is -1
G17
G2 Y-14 X0 R7.0
G17
sign is 1
G17
G2 Y15 X0 R7.5
G17
sign is -1
G17
G2 Y-16 X0 R8.0
G17
sign is 1
G17
G2 Y17 X0 R8.5
G17
sign is -1
G17
G2 Y-18 X0 R9.0
G17
sign is 1
G17
G2 Y19 X0 R9.5
G17
sign is -1
G17
G2 Y-20 X0 R10.0
G17
sign is 1
G17
G2 Y21 X0 R10.5
G17
sign is -1
G17
G2 Y-22 X0 R11.0
G17
sign is 1
G17
G2 Y23 X0 R11.5
G17
sign is -1
G17
G2 Y-24 X0 R12.0
G17
sign is 1
G17
G2 Y25 X0 R12.5
G17
sign is -1
G17
G2 Y-26 X0 R13.0
G17
sign is 1
G17
G2 Y27 X0 R13.5
G17
sign is -1
G17
G2 Y-28 X0 R14.0
G17
sign is 1
G17
G2 Y29 X0 R14.5
G17
sign is -1
G17
G2 Y-30 X0 R15.0
G17
sign is 1
G17
G2 Y31 X0 R15.5
G17
sign is -1
G17
G2 Y-32 X0 R16.0
G17
sign is 1
G17
G2 Y33 X0 R16.5
G17
sign is -1
G17
G2 Y-34 X0 R17.0
G17
sign is 1
G17
G2 Y35 X0 R17.5
G17
sign is -1
G17
G2 Y-36 X0 R18.0
G17
sign is 1
G17
G2 Y37 X0 R18.5
G17
sign is -1
G17
G2 Y-38 X0 R19.0
G17
sign is 1
G17
G2 Y39 X0 R19.5
G17
sign is -1
G17
G2 Y-40 X0 R20.0
G17
sign is 1
G17
G2 Y41 X0 R20.5
G17
sign is -1
G17
G2 Y-42 X0 R21.0
G17
sign is 1
G17
G2 Y43 X0 R21.5
G17
sign is -1
G17
G2 Y-44 X0 R22.0
G17
sign is 1
G17
G2 Y45 X0 R22.5
G17
sign is -1
G17
G2 Y-46 X0 R23.0
G17
sign is 1
G17
G2 Y47 X0 R23.5
G17
sign is -1
G17
G2 Y-48 X0 R24.0
G17
sign is 1
G17
G2 Y49 X0 R24.5
G17
sign is -1
G17
G2 Y-50 X0 R25.0
G17
G90
G1 z0.400000
G91
G90
G1 X0.000000 Y-3.891579
G91
G17
G2 Y7.78315715332 X0 R3.89157857666
G17
G17
G2 Y-8.78315715332 X0 R4.39157857666
G17
G17
G2 Y9.78315715332 X0 R4.89157857666
G17
G17
G2 Y-10.7831571533 X0 R5.39157857666
G17
G17
G2 Y11.7831571533 X0 R5.89157857666
G17
G17
G2 Y-12.7831571533 X0 R6.39157857666
G17
G17
G2 Y13.7831571533 X0 R6.89157857666
G17
G17
G2 Y-14.7831571533 X0 R7.39157857666
G17
G17
G2 Y15.7831571533 X0 R7.89157857666
G17
G17
G2 Y-16.7831571533 X0 R8.39157857666
G17
G17
G2 Y17.7831571533 X0 R8.89157857666
G17
G17
G2 Y-18.7831571533 X0 R9.39157857666
G17
G17
G2 Y19.7831571533 X0 R9.89157857666
G17
G17
G2 Y-20.7831571533 X0 R10.3915785767
G17
G17
G2 Y21.7831571533 X0 R10.8915785767
G17
G17
G2 Y-22.7831571533 X0 R11.3915785767
G17
G17
G2 Y23.7831571533 X0 R11.8915785767
G17
G17
G2 Y-24.7831571533 X0 R12.3915785767
G17
G17
G2 Y25.7831571533 X0 R12.8915785767
G17
G17
G2 Y-26.7831571533 X0 R13.3915785767
G17
G17
G2 Y27.7831571533 X0 R13.8915785767
G17
G17
G2 Y-28.7831571533 X0 R14.3915785767
G17
G17
G2 Y29.7831571533 X0 R14.8915785767
G17
G17
G2 Y-30.7831571533 X0 R15.3915785767
G17
G17
G2 Y31.7831571533 X0 R15.8915785767
G17
G17
G2 Y-32.7831571533 X0 R16.3915785767
G17
G17
G2 Y33.7831571533 X0 R16.8915785767
G17
G17
G2 Y-34.7831571533 X0 R17.3915785767
G17
G17
G2 Y35.7831571533 X0 R17.8915785767
G17
G17
G2 Y-36.7831571533 X0 R18.3915785767
G17
G17
G2 Y37.7831571533 X0 R18.8915785767
G17
G17
G2 Y-38.7831571533 X0 R19.3915785767
G17
G17
G2 Y39.7831571533 X0 R19.8915785767
G17
G17
G2 Y-40.7831571533 X0 R20.3915785767
G17
G17
G2 Y41.7831571533 X0 R20.8915785767
G17
G17
G2 Y-42.7831571533 X0 R21.3915785767
G17
G17
G2 Y43.7831571533 X0 R21.8915785767
G17
G17
G2 Y-44.7831571533 X0 R22.3915785767
G17
G17
G2 Y45.7831571533 X0 R22.8915785767
G17
G17
G2 Y-46.7831571533 X0 R23.3915785767
G17
G17
G2 Y47.7831571533 X0 R23.8915785767
G17
G1 z0.200000
G90
G1 X0.000000 Y-4.648050
G91
G17
G2 Y9.29610059419 X0 R4.6480502971
G17
G17
G2 Y-10.2961005942 X0 R5.1480502971
G17
G17
G2 Y11.2961005942 X0 R5.6480502971
G17
G17
G2 Y-12.2961005942 X0 R6.1480502971
G17
G17
G2 Y13.2961005942 X0 R6.6480502971
G17
G17
G2 Y-14.2961005942 X0 R7.1480502971
G17
G17
G2 Y15.2961005942 X0 R7.6480502971
G17
G17
G2 Y-16.2961005942 X0 R8.1480502971
G17
G17
G2 Y17.2961005942 X0 R8.6480502971
G17
G17
G2 Y-18.2961005942 X0 R9.1480502971
G17
G17
G2 Y19.2961005942 X0 R9.6480502971
G17
G17
G2 Y-20.2961005942 X0 R10.1480502971
G17
G17
G2 Y21.2961005942 X0 R10.6480502971
G17
G17
G2 Y-22.2961005942 X0 R11.1480502971
G17
G17
G2 Y23.2961005942 X0 R11.6480502971
G17
G17
G2 Y-24.2961005942 X0 R12.1480502971
G17
G17
G2 Y25.2961005942 X0 R12.6480502971
G17
G17
G2 Y-26.2961005942 X0 R13.1480502971
G17
G17
G2 Y27.2961005942 X0 R13.6480502971
G17
G17
G2 Y-28.2961005942 X0 R14.1480502971
G17
G17
G2 Y29.2961005942 X0 R14.6480502971
G17
G17
G2 Y-30.2961005942 X0 R15.1480502971
G17
G17
G2 Y31.2961005942 X0 R15.6480502971
G17
G17
G2 Y-32.2961005942 X0 R16.1480502971
G17
G17
G2 Y33.2961005942 X0 R16.6480502971
G17
G17
G2 Y-34.2961005942 X0 R17.1480502971
G17
G17
G2 Y35.2961005942 X0 R17.6480502971
G17
G17
G2 Y-36.2961005942 X0 R18.1480502971
G17
G17
G2 Y37.2961005942 X0 R18.6480502971
G17
G17
G2 Y-38.2961005942 X0 R19.1480502971
G17
G17
G2 Y39.2961005942 X0 R19.6480502971
G17
G17
G2 Y-40.2961005942 X0 R20.1480502971
G17
G17
G2 Y41.2961005942 X0 R20.6480502971
G17
G17
G2 Y-42.2961005942 X0 R21.1480502971
G17
G17
G2 Y43.2961005942 X0 R21.6480502971
G17
G17
G2 Y-44.2961005942 X0 R22.1480502971
G17
G17
G2 Y45.2961005942 X0 R22.6480502971
G17
G17
G2 Y-46.2961005942 X0 R23.1480502971
G17
G17
G2 Y47.2961005942 X0 R23.6480502971
G17
G1 z0.200000
G90
G1 X0.000000 Y-5.326284
G91
G17
G2 Y10.6525685741 X0 R5.32628428703
G17
G17
G2 Y-11.6525685741 X0 R5.82628428703
G17
G17
G2 Y12.6525685741 X0 R6.32628428703
G17
G17
G2 Y-13.6525685741 X0 R6.82628428703
G17
G17
G2 Y14.6525685741 X0 R7.32628428703
G17
G17
G2 Y-15.6525685741 X0 R7.82628428703
G17
G17
G2 Y16.6525685741 X0 R8.32628428703
G17
G17
G2 Y-17.6525685741 X0 R8.82628428703
G17
G17
G2 Y18.6525685741 X0 R9.32628428703
G17
G17
G2 Y-19.6525685741 X0 R9.82628428703
G17
G17
G2 Y20.6525685741 X0 R10.326284287
G17
G17
G2 Y-21.6525685741 X0 R10.826284287
G17
G17
G2 Y22.6525685741 X0 R11.326284287
G17
G17
G2 Y-23.6525685741 X0 R11.826284287
G17
G17
G2 Y24.6525685741 X0 R12.326284287
G17
G17
G2 Y-25.6525685741 X0 R12.826284287
G17
G17
G2 Y26.6525685741 X0 R13.326284287
G17
G17
G2 Y-27.6525685741 X0 R13.826284287
G17
G17
G2 Y28.6525685741 X0 R14.326284287
G17
G17
G2 Y-29.6525685741 X0 R14.826284287
G17
G17
G2 Y30.6525685741 X0 R15.326284287
G17
G17
G2 Y-31.6525685741 X0 R15.826284287
G17
G17
G2 Y32.6525685741 X0 R16.326284287
G17
G17
G2 Y-33.6525685741 X0 R16.826284287
G17
G17
G2 Y34.6525685741 X0 R17.326284287
G17
G17
G2 Y-35.6525685741 X0 R17.826284287
G17
G17
G2 Y36.6525685741 X0 R18.326284287
G17
G17
G2 Y-37.6525685741 X0 R18.826284287
G17
G17
G2 Y38.6525685741 X0 R19.326284287
G17
G17
G2 Y-39.6525685741 X0 R19.826284287
G17
G17
G2 Y40.6525685741 X0 R20.326284287
G17
G17
G2 Y-41.6525685741 X0 R20.826284287
G17
G17
G2 Y42.6525685741 X0 R21.326284287
G17
G17
G2 Y-43.6525685741 X0 R21.826284287
G17
G17
G2 Y44.6525685741 X0 R22.326284287
G17
G17
G2 Y-45.6525685741 X0 R22.826284287
G17
G17
G2 Y46.6525685741 X0 R23.326284287
G17
G17
G2 Y-47.6525685741 X0 R23.826284287
G17
G1 z0.200000
G90
G1 X0.000000 Y-5.880060
G91
G17
G2 Y11.7601200417 X0 R5.88006002087
G17
G17
G2 Y-12.7601200417 X0 R6.38006002087
G17
G17
G2 Y13.7601200417 X0 R6.88006002087
G17
G17
G2 Y-14.7601200417 X0 R7.38006002087
G17
G17
G2 Y15.7601200417 X0 R7.88006002087
G17
G17
G2 Y-16.7601200417 X0 R8.38006002087
G17
G17
G2 Y17.7601200417 X0 R8.88006002087
G17
G17
G2 Y-18.7601200417 X0 R9.38006002087
G17
G17
G2 Y19.7601200417 X0 R9.88006002087
G17
G17
G2 Y-20.7601200417 X0 R10.3800600209
G17
G17
G2 Y21.7601200417 X0 R10.8800600209
G17
G17
G2 Y-22.7601200417 X0 R11.3800600209
G17
G17
G2 Y23.7601200417 X0 R11.8800600209
G17
G17
G2 Y-24.7601200417 X0 R12.3800600209
G17
G17
G2 Y25.7601200417 X0 R12.8800600209
G17
G17
G2 Y-26.7601200417 X0 R13.3800600209
G17
G17
G2 Y27.7601200417 X0 R13.8800600209
G17
G17
G2 Y-28.7601200417 X0 R14.3800600209
G17
G17
G2 Y29.7601200417 X0 R14.8800600209
G17
G17
G2 Y-30.7601200417 X0 R15.3800600209
G17
G17
G2 Y31.7601200417 X0 R15.8800600209
G17
G17
G2 Y-32.7601200417 X0 R16.3800600209
G17
G17
G2 Y33.7601200417 X0 R16.8800600209
G17
G17
G2 Y-34.7601200417 X0 R17.3800600209
G17
G17
G2 Y35.7601200417 X0 R17.8800600209
G17
G17
G2 Y-36.7601200417 X0 R18.3800600209
G17
G17
G2 Y37.7601200417 X0 R18.8800600209
G17
G17
G2 Y-38.7601200417 X0 R19.3800600209
G17
G17
G2 Y39.7601200417 X0 R19.8800600209
G17
G17
G2 Y-40.7601200417 X0 R20.3800600209
G17
G17
G2 Y41.7601200417 X0 R20.8800600209
G17
G17
G2 Y-42.7601200417 X0 R21.3800600209
G17
G17
G2 Y43.7601200417 X0 R21.8800600209
G17
G17
G2 Y-44.7601200417 X0 R22.3800600209
G17
G17
G2 Y45.7601200417 X0 R22.8800600209
G17
G17
G2 Y-46.7601200417 X0 R23.3800600209
G17
G17
G2 Y47.7601200417 X0 R23.8800600209
G17
G1 z0.200000
G90
G1 X0.000000 Y-6.271639
G91
G17
G2 Y12.5432771951 X0 R6.27163859753
G17
G17
G2 Y-13.5432771951 X0 R6.77163859753
G17
G17
G2 Y14.5432771951 X0 R7.27163859753
G17
G17
G2 Y-15.5432771951 X0 R7.77163859753
G17
G17
G2 Y16.5432771951 X0 R8.27163859753
G17
G17
G2 Y-17.5432771951 X0 R8.77163859753
G17
G17
G2 Y18.5432771951 X0 R9.27163859753
G17
G17
G2 Y-19.5432771951 X0 R9.77163859753
G17
G17
G2 Y20.5432771951 X0 R10.2716385975
G17
G17
G2 Y-21.5432771951 X0 R10.7716385975
G17
G17
G2 Y22.5432771951 X0 R11.2716385975
G17
G17
G2 Y-23.5432771951 X0 R11.7716385975
G17
G17
G2 Y24.5432771951 X0 R12.2716385975
G17
G17
G2 Y-25.5432771951 X0 R12.7716385975
G17
G17
G2 Y26.5432771951 X0 R13.2716385975
G17
G17
G2 Y-27.5432771951 X0 R13.7716385975
G17
G17
G2 Y28.5432771951 X0 R14.2716385975
G17
G17
G2 Y-29.5432771951 X0 R14.7716385975
G17
G17
G2 Y30.5432771951 X0 R15.2716385975
G17
G17
G2 Y-31.5432771951 X0 R15.7716385975
G17
G17
G2 Y32.5432771951 X0 R16.2716385975
G17
G17
G2 Y-33.5432771951 X0 R16.7716385975
G17
G17
G2 Y34.5432771951 X0 R17.2716385975
G17
G17
G2 Y-35.5432771951 X0 R17.7716385975
G17
G17
G2 Y36.5432771951 X0 R18.2716385975
G17
G17
G2 Y-37.5432771951 X0 R18.7716385975
G17
G17
G2 Y38.5432771951 X0 R19.2716385975
G17
G17
G2 Y-39.5432771951 X0 R19.7716385975
G17
G17
G2 Y40.5432771951 X0 R20.2716385975
G17
G17
G2 Y-41.5432771951 X0 R20.7716385975
G17
G17
G2 Y42.5432771951 X0 R21.2716385975
G17
G17
G2 Y-43.5432771951 X0 R21.7716385975
G17
G17
G2 Y44.5432771951 X0 R22.2716385975
G17
G17
G2 Y-45.5432771951 X0 R22.7716385975
G17
G17
G2 Y46.5432771951 X0 R23.2716385975
G17
G17
G2 Y-47.5432771951 X0 R23.7716385975
G17
G1 z0.200000
G90
G1 X0.000000 Y-6.474335
G91
G17
G2 Y12.9486691682 X0 R6.47433458412
G17
G17
G2 Y-13.9486691682 X0 R6.97433458412
G17
G17
G2 Y14.9486691682 X0 R7.47433458412
G17
G17
G2 Y-15.9486691682 X0 R7.97433458412
G17
G17
G2 Y16.9486691682 X0 R8.47433458412
G17
G17
G2 Y-17.9486691682 X0 R8.97433458412
G17
G17
G2 Y18.9486691682 X0 R9.47433458412
G17
G17
G2 Y-19.9486691682 X0 R9.97433458412
G17
G17
G2 Y20.9486691682 X0 R10.4743345841
G17
G17
G2 Y-21.9486691682 X0 R10.9743345841
G17
G17
G2 Y22.9486691682 X0 R11.4743345841
G17
G17
G2 Y-23.9486691682 X0 R11.9743345841
G17
G17
G2 Y24.9486691682 X0 R12.4743345841
G17
G17
G2 Y-25.9486691682 X0 R12.9743345841
G17
G17
G2 Y26.9486691682 X0 R13.4743345841
G17
G17
G2 Y-27.9486691682 X0 R13.9743345841
G17
G17
G2 Y28.9486691682 X0 R14.4743345841
G17
G17
G2 Y-29.9486691682 X0 R14.9743345841
G17
G17
G2 Y30.9486691682 X0 R15.4743345841
G17
G17
G2 Y-31.9486691682 X0 R15.9743345841
G17
G17
G2 Y32.9486691682 X0 R16.4743345841
G17
G17
G2 Y-33.9486691682 X0 R16.9743345841
G17
G17
G2 Y34.9486691682 X0 R17.4743345841
G17
G17
G2 Y-35.9486691682 X0 R17.9743345841
G17
G17
G2 Y36.9486691682 X0 R18.4743345841
G17
G17
G2 Y-37.9486691682 X0 R18.9743345841
G17
G17
G2 Y38.9486691682 X0 R19.4743345841
G17
G17
G2 Y-39.9486691682 X0 R19.9743345841
G17
G17
G2 Y40.9486691682 X0 R20.4743345841
G17
G17
G2 Y-41.9486691682 X0 R20.9743345841
G17
G17
G2 Y42.9486691682 X0 R21.4743345841
G17
G17
G2 Y-43.9486691682 X0 R21.9743345841
G17
G17
G2 Y44.9486691682 X0 R22.4743345841
G17
G17
G2 Y-45.9486691682 X0 R22.9743345841
G17
G17
G2 Y46.9486691682 X0 R23.4743345841
G17
G17
G2 Y-47.9486691682 X0 R23.9743345841
G17
G1 z0.200000
G90
G1 z1.600000
G91
G90
G1 z1.600000
G91
F8
G90
G1 X0.350000 Y20.000000
G91
G90
G1 X0.350000 Y7.842194
G91
G90
G17
G2 Y7.84219357068 X-0.35 R-7.85
G17
G91
G90
G1 X-0.350000 Y20.000000
G91
G90
G1 X-1.050000
G91
G90
G1 X-1.050000 Y8.485281
G91
G90
G17
G3 Y8.48528137424 X1.05 R-8.55
G17
G91
G90
G1 X1.050000 Y20.000000
G91
G90
G1 X0.350000
G91
G1 z0.300000
G90
G1 X0.350000 Y20.000000
G91
G90
G1 X0.350000 Y7.842194
G91
G90
G17
G2 Y7.84219357068 X-0.35 R-7.85
G17
G91
G90
G1 X-0.350000 Y20.000000
G91
G90
G1 X-1.050000
G91
G90
G1 X-1.050000 Y8.485281
G91
G90
G17
G3 Y8.48528137424 X1.05 R-8.55
G17
G91
G90
G1 X1.050000 Y20.000000
G91
G90
G1 X0.350000
G91
G1 z0.300000
G90
G1 X0.350000 Y20.000000
G91
G90
G1 X0.350000 Y7.842194
G91
G90
G17
G2 Y7.84219357068 X-0.35 R-7.85
G17
G91
G90
G1 X-0.350000 Y20.000000
G91
G90
G1 X-1.050000
G91
G90
G1 X-1.050000 Y8.485281
G91
G90
G17
G3 Y8.48528137424 X1.05 R-8.55
G17
G91
G90
G1 X1.050000 Y20.000000
G91
G90
G1 X0.350000
G91
G1 z0.300000
G90
G1 X0.350000 Y20.000000
G91
G90
G1 X0.350000 Y7.842194
G91
G90
G17
G2 Y7.84219357068 X-0.35 R-7.85
G17
G91
G90
G1 X-0.350000 Y20.000000
G91
G90
G1 X-1.050000
G91
G90
G1 X-1.050000 Y8.485281
G91
G90
G17
G3 Y8.48528137424 X1.05 R-8.55
G17
G91
G90
G1 X1.050000 Y20.000000
G91
G90
G1 X0.350000
G91
G1 z0.300000
G90
G1 X0.350000 Y20.000000
G91
G90
G1 X0.350000 Y7.842194
G91
G90
G17
G2 Y7.84219357068 X-0.35 R-7.85
G17
G91
G90
G1 X-0.350000 Y20.000000
G91
G90
G1 X-1.050000
G91
G90
G1 X-1.050000 Y8.485281
G91
G90
G17
G3 Y8.48528137424 X1.05 R-8.55
G17
G91
G90
G1 X1.050000 Y20.000000
G91
G90
G1 X0.350000
G91
G1 z0.300000
G90
G1 z1.600000
G91
F8
G90
G1 X-1.250000 Y20.000000
G91
G90
G1 X-1.250000 Y12.789058
G91
G90
G17
G3 Y-11.6460550634 X-5.43064466337 R12.85
G17
G91
G90
G1 X-5.726477 Y-12.280471
G91
G90
G17
G2 Y13.4089522335 X-1.95 R13.55
G17
G91
G90
G1 X-1.950000 Y20.000000
G91
G90
G1 X-1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y20.000000
G91
G90
G1 X-1.250000 Y12.789058
G91
G90
G17
G3 Y-11.6460550634 X-5.43064466337 R12.85
G17
G91
G90
G1 X-5.726477 Y-12.280471
G91
G90
G17
G2 Y13.4089522335 X-1.95 R13.55
G17
G91
G90
G1 X-1.950000 Y20.000000
G91
G90
G1 X-1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y20.000000
G91
G90
G1 X-1.250000 Y12.789058
G91
G90
G17
G3 Y-11.6460550634 X-5.43064466337 R12.85
G17
G91
G90
G1 X-5.726477 Y-12.280471
G91
G90
G17
G2 Y13.4089522335 X-1.95 R13.55
G17
G91
G90
G1 X-1.950000 Y20.000000
G91
G90
G1 X-1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y20.000000
G91
G90
G1 X-1.250000 Y12.789058
G91
G90
G17
G3 Y-11.6460550634 X-5.43064466337 R12.85
G17
G91
G90
G1 X-5.726477 Y-12.280471
G91
G90
G17
G2 Y13.4089522335 X-1.95 R13.55
G17
G91
G90
G1 X-1.950000 Y20.000000
G91
G90
G1 X-1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y20.000000
G91
G90
G1 X-1.250000 Y12.789058
G91
G90
G17
G3 Y-11.6460550634 X-5.43064466337 R12.85
G17
G91
G90
G1 X-5.726477 Y-12.280471
G91
G90
G17
G2 Y13.4089522335 X-1.95 R13.55
G17
G91
G90
G1 X-1.950000 Y20.000000
G91
G90
G1 X-1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 z1.600000
G91
F8
G90
G1 X1.250000 Y20.000000
G91
G90
G1 X1.250000 Y12.789058
G91
G90
G17
G2 Y-11.6460550634 X5.43064466337 R12.85
G17
G91
G90
G1 X5.726477 Y-12.280471
G91
G90
G17
G3 Y13.4089522335 X1.95 R13.55
G17
G91
G90
G1 X1.950000 Y20.000000
G91
G90
G1 X1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y20.000000
G91
G90
G1 X1.250000 Y12.789058
G91
G90
G17
G2 Y-11.6460550634 X5.43064466337 R12.85
G17
G91
G90
G1 X5.726477 Y-12.280471
G91
G90
G17
G3 Y13.4089522335 X1.95 R13.55
G17
G91
G90
G1 X1.950000 Y20.000000
G91
G90
G1 X1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y20.000000
G91
G90
G1 X1.250000 Y12.789058
G91
G90
G17
G2 Y-11.6460550634 X5.43064466337 R12.85
G17
G91
G90
G1 X5.726477 Y-12.280471
G91
G90
G17
G3 Y13.4089522335 X1.95 R13.55
G17
G91
G90
G1 X1.950000 Y20.000000
G91
G90
G1 X1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y20.000000
G91
G90
G1 X1.250000 Y12.789058
G91
G90
G17
G2 Y-11.6460550634 X5.43064466337 R12.85
G17
G91
G90
G1 X5.726477 Y-12.280471
G91
G90
G17
G3 Y13.4089522335 X1.95 R13.55
G17
G91
G90
G1 X1.950000 Y20.000000
G91
G90
G1 X1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y20.000000
G91
G90
G1 X1.250000 Y12.789058
G91
G90
G17
G2 Y-11.6460550634 X5.43064466337 R12.85
G17
G91
G90
G1 X5.726477 Y-12.280471
G91
G90
G17
G3 Y13.4089522335 X1.95 R13.55
G17
G91
G90
G1 X1.950000 Y20.000000
G91
G90
G1 X1.250000 Y20.000000
G91
G1 z0.300000
G90
G1 z1.600000
G91
F8
G90
G1 X-0.350000 Y-20.000000
G91
G90
G1 X-0.350000 Y-10.344080
G91
G90
G17
G2 Y9.38028559583 X-4.37409900902 R10.35
G17
G91
G90
G1 X-4.669932 Y10.014701
G91
G90
G17
G3 Y-11.0 X-1.05 R11.05
G17
G91
G90
G1 X-1.050000 Y-20.000000
G91
G90
G1 X-0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-0.350000 Y-20.000000
G91
G90
G1 X-0.350000 Y-10.344080
G91
G90
G17
G2 Y9.38028559583 X-4.37409900902 R10.35
G17
G91
G90
G1 X-4.669932 Y10.014701
G91
G90
G17
G3 Y-11.0 X-1.05 R11.05
G17
G91
G90
G1 X-1.050000 Y-20.000000
G91
G90
G1 X-0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-0.350000 Y-20.000000
G91
G90
G1 X-0.350000 Y-10.344080
G91
G90
G17
G2 Y9.38028559583 X-4.37409900902 R10.35
G17
G91
G90
G1 X-4.669932 Y10.014701
G91
G90
G17
G3 Y-11.0 X-1.05 R11.05
G17
G91
G90
G1 X-1.050000 Y-20.000000
G91
G90
G1 X-0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-0.350000 Y-20.000000
G91
G90
G1 X-0.350000 Y-10.344080
G91
G90
G17
G2 Y9.38028559583 X-4.37409900902 R10.35
G17
G91
G90
G1 X-4.669932 Y10.014701
G91
G90
G17
G3 Y-11.0 X-1.05 R11.05
G17
G91
G90
G1 X-1.050000 Y-20.000000
G91
G90
G1 X-0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-0.350000 Y-20.000000
G91
G90
G1 X-0.350000 Y-10.344080
G91
G90
G17
G2 Y9.38028559583 X-4.37409900902 R10.35
G17
G91
G90
G1 X-4.669932 Y10.014701
G91
G90
G17
G3 Y-11.0 X-1.05 R11.05
G17
G91
G90
G1 X-1.050000 Y-20.000000
G91
G90
G1 X-0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 z1.600000
G91
F8
G90
G1 X0.350000 Y-20.000000
G91
G90
G1 X0.350000 Y-10.344080
G91
G90
G17
G3 Y9.38028559583 X4.37409900902 R10.35
G17
G91
G90
G1 X4.669932 Y10.014701
G91
G90
G17
G2 Y-11.0 X1.05 R11.05
G17
G91
G90
G1 X1.050000 Y-20.000000
G91
G90
G1 X0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X0.350000 Y-20.000000
G91
G90
G1 X0.350000 Y-10.344080
G91
G90
G17
G3 Y9.38028559583 X4.37409900902 R10.35
G17
G91
G90
G1 X4.669932 Y10.014701
G91
G90
G17
G2 Y-11.0 X1.05 R11.05
G17
G91
G90
G1 X1.050000 Y-20.000000
G91
G90
G1 X0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X0.350000 Y-20.000000
G91
G90
G1 X0.350000 Y-10.344080
G91
G90
G17
G3 Y9.38028559583 X4.37409900902 R10.35
G17
G91
G90
G1 X4.669932 Y10.014701
G91
G90
G17
G2 Y-11.0 X1.05 R11.05
G17
G91
G90
G1 X1.050000 Y-20.000000
G91
G90
G1 X0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X0.350000 Y-20.000000
G91
G90
G1 X0.350000 Y-10.344080
G91
G90
G17
G3 Y9.38028559583 X4.37409900902 R10.35
G17
G91
G90
G1 X4.669932 Y10.014701
G91
G90
G17
G2 Y-11.0 X1.05 R11.05
G17
G91
G90
G1 X1.050000 Y-20.000000
G91
G90
G1 X0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 X0.350000 Y-20.000000
G91
G90
G1 X0.350000 Y-10.344080
G91
G90
G17
G3 Y9.38028559583 X4.37409900902 R10.35
G17
G91
G90
G1 X4.669932 Y10.014701
G91
G90
G17
G2 Y-11.0 X1.05 R11.05
G17
G91
G90
G1 X1.050000 Y-20.000000
G91
G90
G1 X0.350000 Y-20.000000
G91
G1 z0.300000
G90
G1 z1.600000
G91
F8
G90
G1 X-1.250000 Y-20.000000
G91
G90
G1 X-1.250000 Y-15.299020
G91
G90
G17
G2 Y13.911824531 X-6.48719031772 R15.35
G17
G91
G90
G1 X-6.783023 Y14.546240
G91
G90
G17
G3 Y-15.9311016568 X-1.95 R16.05
G17
G91
G90
G1 X-1.950000 Y-20.000000
G91
G90
G1 X-1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y-20.000000
G91
G90
G1 X-1.250000 Y-15.299020
G91
G90
G17
G2 Y13.911824531 X-6.48719031772 R15.35
G17
G91
G90
G1 X-6.783023 Y14.546240
G91
G90
G17
G3 Y-15.9311016568 X-1.95 R16.05
G17
G91
G90
G1 X-1.950000 Y-20.000000
G91
G90
G1 X-1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y-20.000000
G91
G90
G1 X-1.250000 Y-15.299020
G91
G90
G17
G2 Y13.911824531 X-6.48719031772 R15.35
G17
G91
G90
G1 X-6.783023 Y14.546240
G91
G90
G17
G3 Y-15.9311016568 X-1.95 R16.05
G17
G91
G90
G1 X-1.950000 Y-20.000000
G91
G90
G1 X-1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y-20.000000
G91
G90
G1 X-1.250000 Y-15.299020
G91
G90
G17
G2 Y13.911824531 X-6.48719031772 R15.35
G17
G91
G90
G1 X-6.783023 Y14.546240
G91
G90
G17
G3 Y-15.9311016568 X-1.95 R16.05
G17
G91
G90
G1 X-1.950000 Y-20.000000
G91
G90
G1 X-1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X-1.250000 Y-20.000000
G91
G90
G1 X-1.250000 Y-15.299020
G91
G90
G17
G2 Y13.911824531 X-6.48719031772 R15.35
G17
G91
G90
G1 X-6.783023 Y14.546240
G91
G90
G17
G3 Y-15.9311016568 X-1.95 R16.05
G17
G91
G90
G1 X-1.950000 Y-20.000000
G91
G90
G1 X-1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 z1.600000
G91
F8
G90
G1 X1.250000 Y-20.000000
G91
G90
G1 X1.250000 Y-15.299020
G91
G90
G17
G3 Y13.911824531 X6.48719031772 R15.35
G17
G91
G90
G1 X6.783023 Y14.546240
G91
G90
G17
G2 Y-15.9311016568 X1.95 R16.05
G17
G91
G90
G1 X1.950000 Y-20.000000
G91
G90
G1 X1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y-20.000000
G91
G90
G1 X1.250000 Y-15.299020
G91
G90
G17
G3 Y13.911824531 X6.48719031772 R15.35
G17
G91
G90
G1 X6.783023 Y14.546240
G91
G90
G17
G2 Y-15.9311016568 X1.95 R16.05
G17
G91
G90
G1 X1.950000 Y-20.000000
G91
G90
G1 X1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y-20.000000
G91
G90
G1 X1.250000 Y-15.299020
G91
G90
G17
G3 Y13.911824531 X6.48719031772 R15.35
G17
G91
G90
G1 X6.783023 Y14.546240
G91
G90
G17
G2 Y-15.9311016568 X1.95 R16.05
G17
G91
G90
G1 X1.950000 Y-20.000000
G91
G90
G1 X1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y-20.000000
G91
G90
G1 X1.250000 Y-15.299020
G91
G90
G17
G3 Y13.911824531 X6.48719031772 R15.35
G17
G91
G90
G1 X6.783023 Y14.546240
G91
G90
G17
G2 Y-15.9311016568 X1.95 R16.05
G17
G91
G90
G1 X1.950000 Y-20.000000
G91
G90
G1 X1.250000 Y-20.000000
G91
G1 z0.300000
G90
G1 X1.250000 Y-20.000000
G91
G90
G1 X1.250000 Y-15.299020
G91
G90
G17
G3 Y13.911824531 X6.48719031772 R15.35
G17
G91
G90
G1 X6.783023 Y14.546240
G91
G90
G17
G2 Y-15.9311016568 X1.95 R16.05
G17
G91
G90
G1 X1.950000 Y-20.000000
G91
G90
G1 X1.250000 Y-20.000000
G91
G1 z0.300000
;#################################### Code ##########################################

M2

;##########Functions############;
DFS setPress        
         
        $strtask1 = DBLTOSTR( $P, 0 )            
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000
                             
        $press = $Q * 10.0                             
        $strtask2 = DBLTOSTR( $press , 0 )  
      
      
        $length = STRLEN( $strtask2 )      
        WHILE $length < 4.0
                $strtask2 = "0" + $strtask2    
                $length = STRLEN( $strtask2 ) 
        ENDWHILE


        $strtask2 = "08PS  " + $strtask2
                                    
        $cCheck = 0.00     
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 6) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 7) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 8) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 9)  
        $cCheck = $cCheck - $lame
                        
        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE                        


        $strtask3 = makestring "{#H}" $cCheck   
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"
            
        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile


ENDDFS


DFS togglePress        
         
        $strtask1 = DBLTOSTR( $P, 0 )            
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000


        $strtask2 = "04DI  "
                                    
        $cCheck = 0.00     
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5) 
        $cCheck = $cCheck - $lame
                        
        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE                        


        $strtask3 = makestring "{#H}" $cCheck   
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"
                  
        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile
        G4 P0.15

ENDDFS

DFS alignNozzle

	$zStart = $Q
	$delta = $R
	$nozzle = $L
	$floor = $I
	$deltafast = $J

	;#$Ax = 483
	;#$Ay = 317
	;#$Bx = 379
	;#$By = 317
	;#$Cx = 275
	;#$Cy = 317
	;#$Dx = 196
	;#$Dy = 317
	;#$Px = 148
	;#$Py = 345
	
	$Ax = 606.662
	$Ay = 352.920
	$Bx = 502.662
	$By = 352.920
	$Cx = 398.662
	$Cy = 352.920
	$Dx = 319.662
	$Dy = 352.920
	$Px = 148
	$Py = 345
	
	$comport = FILEOPEN "COM8", 2
	COMMINIT $comport, "baud=115200 parity=N data=8 stop=1" ; Initialize comport
	COMMSETTIMEOUT $comport, -1, 0, 0
	
	G90
	G1 A-0.5 B-0.5 C-0.5 D-0.5 F$fastfeed
	IF $nozzle = 1
		$xStart = $Ax
		$yStart = $Ay
		G1 X$xStart Y$yStart
		G1 A$zStart
	ELSE IF $nozzle = 2
		$xStart = $Bx
		$yStart = $By
		G1 X$xStart Y$yStart
		G1 B$zStart
	ELSE IF $nozzle = 3
		$xStart = $Cx
		$yStart = $Cy
		G1 X$xStart Y$yStart
		G1 C$zStart
	ELSE IF $nozzle = 4
		$xStart = $Dx
		$yStart = $Dy
		G1 X$xStart Y$yStart
		G1 D$zStart
	ELSE IF $nozzle = 5
		$xStart = $Px
		$yStart = $Py
		G1 X$xStart Y$yStart
		G1 D$zStart
	ELSE 
		G1 A-1 B-1 C-1 D-1
	ENDIF
	G91


	$found = 0
	WHILE $found != -1
	
		FILEWRITE $comport "M0,0"
		FILEREAD $comport 0 $strglob0	
		$found = STRFIND($strglob0, "--", 1)
		IF $nozzle == 1
			$posZ = AXISSTATUS(A, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==2
			$posZ = AXISSTATUS(B, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==3
			$posZ = AXISSTATUS(C, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==4
			$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==5
			$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
		ENDIF
		
		IF ($posZ - $deltafast) < $floor
			$found = -1
		ELSE
			IF $nozzle == 1
				G1 A-$deltafast F$midfeed
				ELSEIF $nozzle == 2
				G1 B-$deltafast F$midfeed
				ELSEIF $nozzle == 3
				G1 C-$deltafast F$midfeed
				ELSEIF $nozzle == 4
				G1 D-$deltafast F$midfeed
				ELSEIF $nozzle == 5
				G1 D-$deltafast F$midfeed
				ELSE
				MSGDISPLAY 1 "something is messed up"
			ENDIF
		ENDIF
	ENDWHILE

; move up slightly and redo it again slowly
IF $nozzle == 1
			G1 A3.5 F$fastfeed
			ELSEIF $nozzle == 2
			G1 B3.5 F$fastfeed
			ELSEIF $nozzle == 3
			G1 C3.5 F$fastfeed
			ELSEIF $nozzle == 4
			G1 D3.5 F$fastfeed
			ELSEIF $nozzle == 5
			G1 D3.5 F$fastfeed
			ELSE
			MSGDISPLAY 1 "something is messed up"
ENDIF



	$found = 0
WHILE $found != -1

	FILEWRITE $comport "M0,0"
	FILEREAD $comport 0 $strglob0	
	$found = STRFIND($strglob0, "--", 1)
	IF $nozzle ==1
		$posZ = AXISSTATUS(A, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==2
		$posZ = AXISSTATUS(B, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==3
		$posZ = AXISSTATUS(C, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==4
		$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==5
		$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
	ENDIF
	
	IF ($posZ - $deltafast) < $floor
		$found = -1
	ELSE
		IF $nozzle == 1
			G1 A-$delta F$slowfeed
			ELSEIF $nozzle == 2
			G1 B-$delta F$slowfeed
			ELSEIF $nozzle == 3
			G1 C-$delta F$slowfeed
			ELSEIF $nozzle == 4
			G1 D-$delta F$slowfeed
			ELSEIF $nozzle == 5
			G1 D-$delta F$slowfeed
			ELSE
			MSGDISPLAY 1 "something is messed up"
		ENDIF
	ENDIF
ENDWHILE

IF $nozzle == 1
			G1 A-0.4 F$midfeed
			ELSEIF $nozzle == 2
			G1 B-0.4 F$midfeed
			ELSEIF $nozzle == 3
			G1 C-0.4 F$midfeed
			ELSEIF $nozzle == 4
			G1 D-0.4 F$midfeed
			ELSEIF $nozzle == 5
			G1 D-0.4 F$midfeed
			ELSE
			MSGDISPLAY 1 "something is messed up"
ENDIF

;Dwell to get accurate Reading
DWELL 0.75

; read from keyance
FILEWRITE $comport "M0,0"
FILEREAD $comport 0 $strglob0

; Assign Reading To Variables

	$comma1 = STRFIND($strglob0, ",", 1)
	$comma1plus=$comma1+1
	$STRGLOB1 = STRMID ($STRGLOB0, $comma1plus, 40)
	$comma2 = STRFIND($strglob1, ",", 1)
	$comma2 = $comma2 + $comma1
	$comma2plus = $comma2+2
	$STRGLOB2 = STRMID ($STRGLOB0, $comma1plus, $comma2)
	$STRGLOB3 = STRMID ($STRGLOB0, $comma2plus, 40)

		IF $nozzle = 1
			$Ax_dif = STRTODBL($STRGLOB2)
			$Ay_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 2
			$Bx_dif = STRTODBL($STRGLOB2)
			$By_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 3
			$Cx_dif = STRTODBL($STRGLOB2)
			$Cy_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 4
			$Dx_dif = STRTODBL($STRGLOB2)
			$Dy_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 5
			$Px_dif = STRTODBL($STRGLOB2)
			$Py_dif = STRTODBL($STRGLOB3)
		ENDIF

	G90
	G1 A-1 B-1 C-1 D-1 F$fastfeed
	G91
	
	

	FILECLOSE $comport
ENDDFS



DFS alignZeroNozzle

	$zStart = $Q
	$delta = $R
	$nozzle = $L
	$floor = $I
	$deltafast = $J

        ;#$Ax = 483
	;#$Ay = 317
	;#$Bx = 379
	;#$By = 317
	;#$Cx = 275
	;#$Cy = 317
	;#$Dx = 196
	;#$Dy = 317
	;#$Px = 148
	;#$Py = 345
	
	$Ax = 586.075
	$Ay = 367.8285
	$Bx = 482.075
	$By = 367.8285
	$Cx = 378.075
	$Cy = 367.8285
	$Dx = 299.075
	$Dy = 367.8285
	$Px = 148
	$Py = 345
	
	$xOffset = 0.7
	$yOffset = -0.7
	$DO7.0=0
	$comport = FILEOPEN "COM8", 2
	COMMINIT $comport, "baud=115200 parity=N data=8 stop=1" ; Initialize comport
	COMMSETTIMEOUT $comport, -1, 0, 0
	
	
	FILEWRITE $comport "PW,3" ; Select Program #3
	FILEREAD $comport 0 $strglob1

	
	G90
	G1 A-0.5 B-0.5 C-0.5 D-0.5 F$fastfeed
	IF $nozzle = 1
		$xStart = $Ax
		$yStart = $Ay
		G1 X$xStart Y$yStart
		G1 A$zStart
	ELSE IF $nozzle = 2
		$xStart = $Bx
		$yStart = $By
		G1 X$xStart Y$yStart
		G1 B$zStart
	ELSE IF $nozzle = 3
		$xStart = $Cx
		$yStart = $Cy
		G1 X$xStart Y$yStart
		G1 C$zStart
	ELSE IF $nozzle = 4
		$xStart = $Dx
		$yStart = $Dy
		G1 X$xStart Y$yStart
		G1 D$zStart
	ELSE IF $nozzle = 5
		$xStart = $Px
		$yStart = $Py
		G1 X$xStart Y$yStart
		G1 D$zStart
	ELSE 
		G1 A-1 B-1 C-1 D-1
	ENDIF
	G91


	$found = 0
	WHILE $found != -1
	
		FILEWRITE $comport "M0,0"
		FILEREAD $comport 0 $strglob0	
		
		$found = STRFIND($strglob0, "--", 1)
		IF $nozzle == 1
			$posZ = AXISSTATUS(A, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==2
			$posZ = AXISSTATUS(B, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==3
			$posZ = AXISSTATUS(C, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==4
			$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
			ELSEIF $nozzle ==5
			$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
		ENDIF
		
		
		IF ($posZ - $deltafast) < $floor
			$found = -1
		ELSE
			IF $nozzle == 1
				G1 A-$deltafast F$midfeed
				ELSEIF $nozzle == 2
				G1 B-$deltafast F$midfeed
				ELSEIF $nozzle == 3
				G1 C-$deltafast F$midfeed
				ELSEIF $nozzle == 4
				G1 D-$deltafast F$midfeed
				ELSEIF $nozzle == 5
				G1 D-$deltafast F$midfeed
				ELSE
				MSGDISPLAY 1 "something is messed up"
			ENDIF
		ENDIF
		
	ENDWHILE

; move up slightly and redo it again slowly
IF $nozzle == 1
			G1 A3.5 F$fastfeed
			ELSEIF $nozzle == 2
			G1 B3.5 F$fastfeed
			ELSEIF $nozzle == 3
			G1 C3.5 F$fastfeed
			ELSEIF $nozzle == 4
			G1 D3.5 F$fastfeed
			ELSEIF $nozzle == 5
			G1 D3.5 F$fastfeed
			ELSE
			MSGDISPLAY 1 "something is messed up"
ENDIF



	$found = 0
WHILE $found != -1

	FILEWRITE $comport "M0,0"
	FILEREAD $comport 0 $strglob0	
	$found = STRFIND($strglob0, "--", 1)
	IF $nozzle ==1
		$posZ = AXISSTATUS(A, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==2
		$posZ = AXISSTATUS(B, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==3
		$posZ = AXISSTATUS(C, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==4
		$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
		ELSEIF $nozzle ==5
		$posZ = AXISSTATUS(D, DATAITEM_PositionFeedback)
	ENDIF
	
	IF ($posZ - $deltafast) < $floor
		$found = -1
	ELSE
		IF $nozzle == 1
			G1 A-$delta F$slowfeed
			ELSEIF $nozzle == 2
			G1 B-$delta F$slowfeed
			ELSEIF $nozzle == 3
			G1 C-$delta F$slowfeed
			ELSEIF $nozzle == 4
			G1 D-$delta F$slowfeed
			ELSEIF $nozzle == 5
			G1 D-$delta F$slowfeed
			ELSE
			MSGDISPLAY 1 "something is messed up"
		ENDIF
	ENDIF
ENDWHILE

IF $nozzle == 1
			G1 A-0.4 F$midfeed
			ELSEIF $nozzle == 2
			G1 B-0.4 F$midfeed
			ELSEIF $nozzle == 3
			G1 C-0.4 F$midfeed
			ELSEIF $nozzle == 4
			G1 D-0.4 F$midfeed
			ELSEIF $nozzle == 5
			G1 D-0.4 F$midfeed
			ELSE
			MSGDISPLAY 1 "something is messed up"
ENDIF

;Dwell to get accurate Reading
DWELL 0.75

; read from keyance
FILEWRITE $comport "M0,0"
FILEREAD $comport 0 $strglob0

; Assign Reading To Variables

	$comma1 = STRFIND($strglob0, ",", 1)
	$comma1plus=$comma1+1
	$STRGLOB1 = STRMID ($STRGLOB0, $comma1plus, 40)
	$comma2 = STRFIND($strglob1, ",", 1)
	$comma2 = $comma2 + $comma1
	$comma2plus = $comma2+2
	$STRGLOB2 = STRMID ($STRGLOB0, $comma1plus, $comma2)
	$STRGLOB3 = STRMID ($STRGLOB0, $comma2plus, 40)

		IF $nozzle = 1
			$Ax_dif = STRTODBL($STRGLOB2)
			$Ay_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 2
			$Bx_dif = STRTODBL($STRGLOB2)
			$By_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 3
			$Cx_dif = STRTODBL($STRGLOB2)
			$Cy_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 4
			$Dx_dif = STRTODBL($STRGLOB2)
			$Dy_dif = STRTODBL($STRGLOB3)
			ELSEIF $nozzle == 5
			$Px_dif = STRTODBL($STRGLOB2)
			$Py_dif = STRTODBL($STRGLOB3)
		ENDIF


;switch keyence programs
$DO7.0=1
FILEWRITE $comport "PW,4" ; Select Program #4
FILEREAD $comport 0 $strglob1

; Attain zero value
        IF $nozzle = 1
			G91
			G1 X-$Ax_dif Y-$Ay_dif F5
			G1 X$xOffset Y$yOffset
			$zMeasureA = AXISSTATUS(A, DATAITEM_PositionFeedback)
			DWELL 3
			CALL zHold Q3 R0.075 L0.25
	                $Az_dif = $z_dif
	                MSGDISPLAY 1 "Az_dif: " + $Az_dif
			MSGDISPLAY 1 "zMeasureA: " + $zMeasureA
			
			ELSEIF $nozzle == 2
			G91
			G1 X-$Bx_dif Y-$By_dif F5
			G1 X$xOffset Y$yOffset
			DWELL 3
			$zMeasureB = AXISSTATUS(B, DATAITEM_PositionFeedback)
			CALL zHold Q3 R0.025 L0.25
	                $Bz_dif = $z_dif
	                MSGDISPLAY 1 "Bz_dif: " + $Bz_dif
			MSGDISPLAY 1 "zMeasureB: " + $zMeasureB
	                
			ELSEIF $nozzle == 3
			G91
			G1 X-$Cx_dif Y-$Cy_dif F5
			G1 X$xOffset Y$yOffset
			DWELL 3
			$zMeasureC = AXISSTATUS(C, DATAITEM_PositionFeedback)
			CALL zHold Q3 R0.025 L0.25
	                $Cz_dif = $z_dif
	                MSGDISPLAY 1 "Cz_dif: " + $Cz_dif
			MSGDISPLAY 1 "zMeasureC: " + $zMeasureC
	                
			ELSEIF $nozzle == 4
			G91
			G1 X-$Dx_dif Y-$Dy_dif F5
			G1 X$xOffset Y$yOffset
			DWELL 3
			$zMeasureD = AXISSTATUS(D, DATAITEM_PositionFeedback)
			CALL zHold Q3 R0.025 L0.25
	                $Dz_dif = $z_dif
	                MSGDISPLAY 1 "Dz_dif: " + $Dz_dif
			MSGDISPLAY 1 "zMeasureD: " + $zMeasureD
		ENDIF

$DO7.0=0
FILEWRITE $comport "PW,3" ; Select Program #3
FILEREAD $comport 0 $strglob1
	G90
	G1 A-1 B-1 C-1 D-1 F$fastfeed
	G91
	
	

	FILECLOSE $comport
ENDDFS

DFS zHold
    $zSweepRange = $Q
    $zSweepStep = $R
    $zDwell = $L
    $start = (($zSweepRange/2)/1.414213)
    $x_dist = (($zSweepRange)/1.414213)
    
    G91
    G1 X-($start) Y$start F2

    FILEWRITE $comport "U1"
    FILEREAD $comport 0 $strglob0
    G1 X$x_dist Y-$x_dist F0.5
    FILEWRITE $comport "L1,0"
    FILEREAD $comport 0 $strglob0
    $STRGLOB1 = STRMID ($STRGLOB0, 4, -1)
    $z_dif = STRTODBL($STRGLOB1)

ENDDFS
        


DFS zSweep
$zSweepRange = $Q
$zSweepStep = $R
$zDwell = $L


$indicator = 0
$z_num = 0
$numsteps = ($zSweepRange/$zSweepStep)
$start = (($zSweepRange/2)/1.414213)
$step = $zSweepStep/1.414213
$z_dif=6
$count = 0
G91
G1 X-($start) Y$start F2

WHILE $count<$numsteps
	
	
	Dwell $zDwell
	FILEWRITE $comport "M2,0"
	FILEREAD $comport 0 $strglob0
	$STRGLOB1 = STRMID ($STRGLOB0, 4, -1)
	$tempdistance = STRTODBL($STRGLOB1)
	IF $tempdistance < $z_dif
	        $z_dif=$tempdistance
	        $z_past = $z_dif + 1
		;$indicator = 1
                MSGDISPLAY 1 "zdif recorded: " + $z_dif
	ENDIF
	IF $indicator = 1
	       IF $tempdistance > $z_past
	           $z_num = $z_num + 1
	       ELSE 
	           $z_num = 0
	       ENDIF
	ENDIF
	IF $z_num = 5
	   GOTO quit_loop
	ENDIF
	$count = $count + 1
	G1 X($step) Y-$step F2
ENDWHILE
:quit_loop
ENDDFS

DFS save_value

    $nozzle = $Q
IF $nozzle = 1
    $align_save = FILEOPEN "C:\Users\Lewis Group\Desktop\Alignment\alignment_values_1.txt", 0
    FILEWRITE $align_save "$Ax_dif = " + $Ax_dif
    FILEWRITE $align_save "$Ay_dif = " + $Ay_dif
    FILEWRITE $align_save "$zMeasureA = " + $zMeasureA
    FILEWRITE $align_save "$Az_dif = " + $Az_dif
ENDIF
IF $nozzle = 2
    $align_save = FILEOPEN "C:\Users\Lewis Group\Desktop\Alignment\alignment_values_2.txt", 0
    FILEWRITE $align_save "$Bx_dif = " + $Bx_dif
    FILEWRITE $align_save "$By_dif = " + $By_dif
    FILEWRITE $align_save "$zMeasureB = " + $zMeasureB
    FILEWRITE $align_save "$Bz_dif = " + $Bz_dif
ENDIF
IF $nozzle = 3
    $align_save = FILEOPEN "C:\Users\Lewis Group\Desktop\Alignment\alignment_values_3.txt", 0
    FILEWRITE $align_save "$Cx_dif = " + $Cx_dif
    FILEWRITE $align_save "$Cy_dif = " + $Cy_dif
    FILEWRITE $align_save "$zMeasureC = " + $zMeasureC
    FILEWRITE $align_save "$Cz_dif = " + $Cz_dif
ENDIF
IF $nozzle = 4
    $align_save = FILEOPEN "C:\Users\Lewis Group\Desktop\Alignment\alignment_values_4.txt", 0
    FILEWRITE $align_save "$Dx_dif = " + $Dx_dif
    FILEWRITE $align_save "$Dy_dif = " + $Dy_dif
    FILEWRITE $align_save "$zMeasureD = " + $zMeasureD
    FILEWRITE $align_save "$Dz_dif = " + $Dz_dif
ENDIF


FILECLOSE $align_save
ENDDFS
